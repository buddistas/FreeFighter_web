# FreeFighter - Android приложение

Браузерная игра-симулятор боя для Android на базе Capacitor.

## Описание игры

FreeFighter — однопользовательская игра-симулятор боя, основанная на механике выбора из трех вариантов атаки и защиты. Игрок соревнуется с компьютерным противником, предугадывая его действия и планируя свои собственные.

### Основная механика

- Игрок и противник выбирают последовательности из трех действий
- Каждое действие может быть направлено на три зоны: верх (голова), середина (тело), низ (ноги)
- Атакующий выбирает зону для удара, защищающийся — зону для блока
- Успешный удар наносит урон, заблокированный удар игнорируется
- Начальное здоровье: 12 HP у каждого бойца
- Каждый незаблокированный удар отнимает 1 HP
- При достижении 0 HP боец проигрывает
- При одновременном обнулении здоровья обоих бойцов играется дополнительный раунд с 2 HP у каждого

### Критические удары

В игре существует система критических ударов, которые наносят удвоенный урон:

- **Крит в голову**: 10% вероятность при ударе в верхнюю зону
- **Крит в тело**: 5% вероятность при ударе в среднюю зону
- **Крит в ноги**: 5% вероятность при ударе в нижнюю зону

При успешном критическом ударе наносится 2 единицы урона вместо 1. Критические удары отображаются специальным сообщением "CRITICAL HIT!" во время боя.

### Специальные перки

Перед началом каждого боя игрок может выбрать один специальный перк, который влияет на игровой процесс:

- **HeadHunter** — удваивает шанс критического удара при атаке в верхнюю зону (10% → 20%)
- **BodyHunter** — удваивает шанс критического удара при атаке в среднюю зону (5% → 10%)
- **LegHunter** — удваивает шанс критического удара при атаке в нижнюю зону (5% → 10%)
- **TieBreaker** — в дополнительных раундах дает 4 HP вместо стандартных 2 HP
- **HPBoost** — в начале боя дает 13 HP вместо стандартных 12 HP
- **CritDeflector** — с шансом 50% превращает критический удар противника в обычный удар
- **Lucker?** — с шансом 50% удваивает урон от крита (x4 вместо x2)
- **BlockMaster** — при успешном блокировании двух ударов подряд восстанавливает 1 HP (не больше максимума)
- **FinishHim** — если у противника на конец раунда осталось 1 HP, уменьшает его HP на 1 (не работает в дополнительных раундах)

**Важно:**
- Перк выбирается один раз перед началом боя
- Выбранный перк действует на протяжении всего боя
- Противник также получает случайный перк перед боем
- Активные перки отображаются под полосками здоровья игрока и противника (короткие названия: HeadHunter, BodyHunter, LegHunter, TieBreaker, HPBoost, CritDeflector, Lucker?, BlockMaster, FinishHim)
- При новой игре перки выбираются заново

### Типы личности противника

Перед началом каждого боя игрок может выбрать один из трех типов личности противника:

- **Рандомный** — противник использует полностью случайный выбор действий для атак и блоков
- **Упорный** — противник склонен повторять одинаковые действия (70% вероятность повтора предыдущего действия)
- **Адаптивный** — противник анализирует паттерны поведения игрока и адаптирует свою стратегию

#### Адаптивный AI (детальное описание)

Адаптивный противник использует систему анализа паттернов для противодействия стилю игры игрока.

**Параметры системы:**
- Минимальное количество раундов для активации: **3**
- Количество хранимых последовательностей: **5** (для атак и блоков отдельно)
- Порог преобладания зоны: **>50%**
- Порог сильного паттерна: **>70%** для зон, **4+ повтора** для последовательностей
- Вес слабого паттерна: **60%** (40% случайность)
- Вес сильного паттерна: **80%** (20% случайность)

**Анализируемые паттерны:**
1. Преобладание зоны — если игрок атакует/защищает одну зону более чем в 50% случаев
2. Повторяющиеся последовательности — если игрок повторяет одну и ту же последовательность из 3 действий 2+ раза

**Стратегия противника:**
- При защите: блокирует предпочитаемые зоны атак игрока или повторяющиеся последовательности
- При атаке: атакует в зоны, отличные от предпочитаемых зон блоков игрока

Подробное описание логики работы адаптивного AI см. в файле `PLAN.md`.

## Быстрый старт

### 1. Установка зависимостей

```bash
npm install
```

### 2. Разработка и тестирование в браузере

#### Режим с автоматическим копированием (рекомендуется)

Запустите сервер с автоматическим копированием файлов при изменениях:

```bash
npm run dev:watch
```

Этот режим:
- Автоматически копирует файлы из корня проекта в `www/` при каждом изменении
- Запускает локальный сервер на http://localhost:8080
- Не требует ручного копирования файлов после каждого изменения

#### Обычный режим

Если нужен обычный сервер без автоматического копирования:

```bash
npm run dev
```

**Важно:** Все изменения делайте в исходных файлах в корне проекта:
- `index.html`
- `game.js`
- `styles.css`
- `pics/` - изображения
- `icons/` - иконки приложения

**Примечание:** Сервер отдает файлы из папки `www/`, поэтому изменения в корневых файлах автоматически копируются в `www/` при использовании `npm run dev:watch`. Если используете `npm run dev`, нужно вручную запускать `npm run copy-assets` после каждого изменения.

### 3. Синхронизация с Android-проектом

После внесения изменений в веб-код, синхронизируйте их с Android-проектом:

```bash
npm run build
```

Или вручную:
```bash
npm run copy-assets
npm run sync:android
```

### 4. Тестирование на Android

#### Вариант 1: Через Android Studio (рекомендуется)

1. Откройте Android-проект:
```bash
npm run open:android
```

2. В Android Studio:
   - Подождите, пока проект загрузится
   - Подключите Android-устройство или запустите эмулятор
   - Нажмите кнопку "Run" (зеленая стрелка) или `Shift+F10`

#### Вариант 2: Через командную строку (требует настройки ADB)

```bash
cd android
./gradlew installDebug
```

### 5. Сборка APK

#### Debug APK (для тестирования)

```bash
cd android
./gradlew assembleDebug
```

APK файл будет в: `android/app/build/outputs/apk/debug/app-debug.apk`

#### Release APK (для публикации)

1. Настройте подпись приложения в Android Studio
2. Соберите release версию через Android Studio: `Build > Generate Signed Bundle / APK`

## Структура проекта

```
FreeFighter_web/
├── index.html              # Главная HTML страница
├── game.js                 # Логика игры
├── styles.css              # Стили
├── manifest.json           # PWA манифест
├── capacitor.config.json   # Конфигурация Capacitor
├── package.json            # NPM зависимости и скрипты
├── pics/                   # Изображения игры
├── icons/                  # Иконки приложения (PNG и SVG)
├── scripts/                # Вспомогательные скрипты
│   ├── copy-assets.js      # Копирование файлов в www
│   ├── generate-icons.js   # Генерация SVG иконок
│   └── generate-png-icons.js # Генерация PNG иконок
├── tests/                  # Тесты (структура для будущих тестов)
├── www/                    # Скомпилированные веб-ресурсы (автоматически)
└── android/                # Android-проект (автоматически)
```

## Команды

| Команда | Описание |
|---------|----------|
| `npm run dev` | Запуск локального сервера для разработки (требует ручного копирования файлов) |
| `npm run dev:watch` | Запуск сервера с автоматическим копированием файлов при изменениях (рекомендуется) |
| `npm run build` | Копирование файлов и синхронизация с Android |
| `npm run copy-assets` | Только копирование файлов в www |
| `npm run sync:android` | Только синхронизация с Android-проектом |
| `npm run open:android` | Открыть Android-проект в Android Studio |

## Генерация иконок

Если нужно перегенерировать иконки:

```bash
# Генерация SVG иконок
node scripts/generate-icons.js

# Генерация PNG иконок (требует canvas)
node scripts/generate-png-icons.js
```

## Требования

- **Node.js** 16+ (для работы с npm и Capacitor)
- **Android Studio** (для сборки APK и эмулятора)
- **Java JDK** (обычно идет с Android Studio)

## Важные замечания

1. **Всегда редактируйте исходные файлы** в корне проекта, а не в папке `www/`
2. **Используйте `npm run dev:watch`** для автоматического копирования файлов при разработке
3. **После изменений** выполняйте `npm run build` для синхронизации с Android
4. **Тестирование** происходит в браузере - Android Studio нужен только для финальной проверки
5. **Папки `www/` и `android/`** генерируются автоматически, не редактируйте их вручную
6. **Сервер отдает файлы из `www/`**, поэтому изменения в корневых файлах нужно копировать (автоматически при `dev:watch` или вручную через `copy-assets`)

## Устранение проблем

### Ошибка "webDir is not valid"
Убедитесь, что в `capacitor.config.json` указан `"webDir": "www"`

### Изменения не отображаются в приложении
Выполните `npm run build` для синхронизации изменений

### Ошибки при сборке APK
1. Убедитесь, что Android Studio установлен и настроен
2. Проверьте, что Android SDK установлен
3. Попробуйте очистить проект: `cd android && ./gradlew clean`

## Тестирование

### Android тесты

Android тесты находятся в:
- `android/app/src/test/` - Unit тесты
- `android/app/src/androidTest/` - Instrumented тесты

Запуск тестов:
```bash
cd android
./gradlew test          # Unit тесты
./gradlew connectedAndroidTest  # Instrumented тесты (требует устройство/эмулятор)
```

### Веб тесты

Структура для веб-тестов подготовлена в папке `tests/`. Можно добавить тесты для логики игры.

## Следующие шаги

После успешной сборки можно:
- Добавить вибрацию при ударах
- Добавить звуковые эффекты
- Настроить подпись для публикации в Google Play
- Добавить аналитику
- Оптимизировать производительность
- Добавить веб-тесты для логики игры

